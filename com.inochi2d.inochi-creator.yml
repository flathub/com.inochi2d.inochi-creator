id: com.inochi2d.inochi-creator
runtime: org.freedesktop.Platform
runtime-version: "22.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.ldc
command: inochi-creator
finish-args:
  - --device=all     #OpenGL rendering, webcams (may be required? not sure)
  - --socket=fallback-x11
  - --share=ipc     
  - --socket=wayland  
  - --filesystem=host     #This is a dev tool, it should probably have as much access to the host as it can. Also needs it for "Recent Files"


#This extension will be needed in some newer releases, as of https://github.com/Inochi2D/inochi-creator/commit/5d67cded1273aced9033d327a8eb29c6f078a3c0
add-extensions:
  org.freedesktop.Platform.ffmpeg-full:
    version: '22.08'
    autodownload: true
    autodelete: false


modules:

  - shared-modules/SDL2/SDL2-2.26.1-with-libdecor.json

  # --- Inochi Creator ---
  - name: Inochi-Creator
    buildsystem: simple
    build-commands:

    # All the needed manual dependencies
      -  dub add-local bindbc-imgui/ "0.7.0";
        dub add-local inochi2d/ "0.7.2";
        dub add-local facetrack-d/ "0.6.2";
        dub add-local i18n/ "1.0.1";
        dub add-local dcv-i2d/ "0.3.0";


        dub build --compiler=ldc2 --build=release --config=full

    sources:
      - inochi-creator-sources.json

  - name: Metadata
    buildsystem: simple
    build-commands:

      - install -Dm644 com.inochi2d.inochi-creator.metadata.xml /app/share/metainfo/com.inochi2d.inochi-creator.metainfo.xml
      - install -Dm644 ./creator/icon_128.png /app/share/icons/hicolor/128x128/apps/com.inochi2d.inochi-creator.png
      - install -Dm644 ./creator/icon_256.png /app/share/icons/hicolor/256x256/apps/com.inochi2d.inochi-creator.png
      - install -Dm644 ./creator/icon_512.png /app/share/icons/hicolor/512x512/apps/com.inochi2d.inochi-creator.png
      - install -Dm644 ./inochi-creator/res/inochi-creator.desktop /app/share/applications/com.inochi2d.inochi-creator.desktop

    sources:
      - type: git
        url: https://github.com/Inochi2D/branding.git
        commit: a412602d346ba69c63237217ae286112e300927d

      - type: git
        url: https://github.com/Inochi2D/inochi-creator.git
        commit: 7f5feb962aea6c3faebe309c7e0d839b9211a59f
        dest: inochi-creator/

      - type: patch
        strip-components: 0
        path: desktopfile.patch


      - type: file
        path: com.inochi2d.inochi-creator.metadata.xml
        
